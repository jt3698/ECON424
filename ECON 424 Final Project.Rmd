---
title: "ECON 424 - Final Project (Winter 2023)"
author: "Submitted by Raphael Shawn Gozali (20805288) and Jason Tedjosoesilo (20801292)"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
```

```{r, include = FALSE}
library(knitr)
opts_chunk$set(tidy.opts=list(width.cutoff=60), tidy = TRUE)
```



## Questions

For this project, these are the questions that we will be answering:

1. Without any interactions, which covariate(s) affect revenue the most?

2. Are there any certain genres, actors, or keywords that affect revenue the most?

3. If we do interactions between genres, actors, and keywords, are there any particular combination(s) that affect revenue the most?

4. Do people’s preferences on movie genres and actors change over the years/decades?

## Data

In this project, we will be using the Movies dataset from Kaggle: https://www.kaggle.com/datasets/akshaypawar7/millions-of-movies?resource=download. We downloaded this dataset on April 2, 2023 on 2pm EST and continue to work with it locally. This dataset consists of around 723 thousand rows of movies, with their descriptions and details separated into columns. The response variable that we are focusing on from this dataset is the “revenue” column, which shows us the revenue of the movie. The covariates that might be useful from this dataset includes: date published, budget, genres, casts, keywords, and runtime.

Here is the first few rows of the data:

```{r}
data <- read.csv("./movies.csv")
head(data)
```

Before we do some analysis, we will clean the data. First, we will remove unnecessary columns and also data with zero revenues. We are only keeping released movies above 40 minutes as we are not including short movies in the data. This is based on the definition from the Academy of Motion Picture Arts and Sciences, where they define a short film as "an original motion picture that has a running time of 40 minutes or less, including all credits". We also do not include the movies with runtime of value 999. There might also be duplicates in the data, so we need to remove duplicates as well. Since people can add random movies into this database, we try as best as we can to filter those out. To make sure that a movie is legitimate, we filter the movies that do not have any genres, production companies, and credits (all three are empty values).

```{r}
# Only movies that has revenue, is released, and more than 40 minutes long
# Also remove if runtime = 999 and remove the movies with missing genres, production companies, and credits
clean_data <- data[data$revenue > 0 & data$status == "Released" & data$runtime > 40 & data$runtime != 999 & !(data$genres == "" & data$production_companies == "" & data$credits == ""), !names(data) %in% c("overview", "popularity","status", "tagline", "vote_average","vote_count","poster_path","backdrop_path","recommendations")]


# removing empty ID rows
clean_data <- clean_data[!is.na(clean_data$id),]

#resetting row.names
row.names(clean_data) <- NULL

#remove duplicate data
clean_data <- clean_data[!duplicated(clean_data[,1]),]

write.csv(clean_data, file="./movies_filtered.csv", row.names = FALSE)

n <- length(clean_data[,1])

head(clean_data)

hist(log(clean_data$revenue), 
     breaks = quantile(log(clean_data$revenue), p = seq(0,1 , length.out = 21)), 
     freq = FALSE, xlab = "log(revenue)", main = "Histogram of log(revenue) - 5% quantile for each bin")

```

We took this data and use a Python API to calculate the adjusted revenues by adding inflation factors. We calculated all the revenues inflated to April 3, 2023 and include them in the data as a new column called "revenue_adjusted". The data that do not have release_date will have their adjusted revenue be the same as their revenue.

```{r}
clean_data <- read.csv("./movies_adjusted.csv")
head(clean_data)

hist(log(clean_data$revenue_adjusted), 
     breaks = quantile(log(clean_data$revenue_adjusted), p = seq(0,1 , length.out = 21)), 
     freq = FALSE, xlab = "log(revenue_adjusted)", main = "Histogram of log(revenue_adjusted) - 5% quantile for each bin")

n <- length(clean_data[,1])
```

## Methods

To answer the questions above, we will be doing these methods:

```{r}
library(pdftools)
library(tm)
library(SnowballC)

to_another <- content_transformer(function(x, y, z) gsub(y, z, x))

#### PRODUCTION COMPANIES
prod_comp <- clean_data$production_companies
docs <- Corpus(VectorSource(prod_comp))
# Remove "-" from the name since it is the splitter symbol of the data
docs <- tm_map(docs, to_another, "Metro-Goldwyn-Mayer", "Metro_Goldwyn_Mayer")
docs <- tm_map(docs, to_another, " ", "_")
docs <- tm_map(docs, to_another, "-", " ")
dtm <- DocumentTermMatrix(docs)

#get production companies in least 50 movies
key_pc <- sort(findFreqTerms(dtm, 50))
key_pc
```

```{r}
#### GENRES
genres <- clean_data$genres
docs2 <- Corpus(VectorSource(genres))
docs2 <- tm_map(docs2, to_another, " ", "_")
docs2 <- tm_map(docs2, to_another, "-", " ")
dtm2 <- DocumentTermMatrix(docs2)

#get all genres
key_gen <- sort(findFreqTerms(dtm2, 0))
key_gen
```

```{r}
#### CREDITS
casts <- clean_data$credits
docs3 <- Corpus(VectorSource(casts))
docs3 <- tm_map(docs3, to_another, " ", "_")
docs3 <- tm_map(docs3, to_another, "-", " ")
dtm3 <- DocumentTermMatrix(docs3)

#get all casts in at least 50 movies
key_cast <- sort(findFreqTerms(dtm3, 50))

#remove single-word names
key_cast <- key_cast[grepl('_', key_cast)]
key_cast
```

```{r}
#### KEYWORDS
keywords <- clean_data$keywords
docs4 <- Corpus(VectorSource(keywords))
docs4 <- tm_map(docs4, to_another, " ", "_")
docs4 <- tm_map(docs4, to_another, "-", " ")
dtm4 <- DocumentTermMatrix(docs4)

#get all keywords in at least 50 movies
key_keys <- sort(findFreqTerms(dtm4, 50))
key_keys
```

```{r}


```

2. Use parameter reduction and regression via LASSO to get a certain number of covariates and see which covariates impact the most to the revenue.

3. Get the genres, actors, and keywords from their respective columns (each separated by “-”), filter these words by number of appearance more than a certain number, and then use these words as covariates in regression.

4. Get the words from step 3 and create interactions between them. Include these interactions as covariates in the regression.

5. Separate the data by year/decade published and do the modelling using LASSO on these subgroups and see whether the model changes over time.

## Results

From this project, we hope to get a good model based on this data where revenue is based only on a small number of covariates, i.e a small number of elasticities. We also hope to get interesting keywords and interactions between genres and casts that can affect revenue of the movie. Changes in people’s preferences of the movies over the years/decades are also expected here, since the trends between generations are likely to be different.
